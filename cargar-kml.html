document.getElementById('uploadButton').addEventListener('click', () => {
    const fileInput = document.getElementById('jsonFileInput');
    const file = fileInput.files[0];  // Obtener el archivo seleccionado

    if (file) {
        const fileName = file.name.replace('.json', '');  // Obtener el nombre del archivo sin la extensión

        const reader = new FileReader();  // Crear un FileReader
        reader.onload = function(event) {
            try {
                const geojsonData = JSON.parse(event.target.result);  // Intentar parsear el JSON

                // Asegurarse de que "Campo" se encuentra en el primer feature del JSON
                const campoValue = geojsonData.features[0].properties.Campo;
                
                if (!campoValue) {
                    throw new Error('"Campo" no encontrado en el JSON');
                }

                const polygonName = `${fileName} - ${campoValue}`;  // Crear el nombre del polígono

                const apiKey = 'be9b9f7295d5f005696dec5b3f7d1d63'; 
                const url = `https://api.agromonitoring.com/agro/1.0/polygons?appid=${apiKey}`;
                
                // Hacer la solicitud POST a la API de Agromonitoring
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "geo_json": geojsonData,
                        "name": polygonName  // Usar el nombre del polígono generado
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.id) {
                        console.log('Polígono creado con éxito. ID del polígono:', data.id);
                    } else {
                        console.error('No se encontró el ID del polígono en la respuesta:', data);
                    }
                })
                .catch(error => {
                    console.error('Error al crear el polígono:', error);
                });
            } catch (e) {
                console.error('Error al procesar el JSON:', e.message);
            }
        };
        reader.readAsText(file);  // Leer el contenido del archivo como texto
    } else {
        console.error('No se ha seleccionado ningún archivo.');
    }
});
